---
layout: single
title: "Django ì‹œì‘í•˜ê¸°(3) - í˜ì´ì§€ ë„ì›Œë³´ê¸°"
excerpt: "í˜ì´ì§€-ê¸°ëŠ¥ ì—°ê²°í•˜ê³  ë„ì›Œë³´ê¸°"
categories:
  - django
tags:
  - python
  - django
toc: true
toc_sticky: true
---

## urls.py

â†’ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²½ë¡œ ì§€ì •

â†’ config\urls.py ì´ì™¸ì— ì•±í´ë”ì— ë˜ ë‹¤ë¥¸ urls.pyë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ

### ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” ê³¼ì •

1. http://127.0.0.1:8000/photo/ ë¼ëŠ” requestê°€ ë“¤ì–´ì˜¤ë©´

   ![Untitled 7](https://user-images.githubusercontent.com/115909999/219252837-513fd799-4f56-41d3-971e-ecadcf541f18.png)

2. config/urls.py ê°€ 1ì°¨ ì‘ë‹µ
3. config/urls.pyì— ì‘ì„±ë˜ì–´ ìˆëŠ” ì½”ë“œë¥¼ ë”°ë¼ ì•±í´ë”/urls.pyë¡œ ì´ë™í•˜ì—¬ 2ì°¨ ì‘ë‹µ

   ```python
   # config/urls.py
   from django.contrib import admin
   from django.urls import path, include

   urlpatterns = [
       path('admin/', admin.site.urls),
       path('photo/', include('testapp.urls')), # 127.0.0.1:8000/photo/ ë©´ testapp ì•±ì˜ urls.py ë¡œ ê°€ë¼!
   ]
   ```

4. 2ì°¨ ì‘ë‹µê³¼ì •ì—ì„œ pathë¥¼ ë”°ë¼ views.xxx í•¨ìˆ˜ë¥¼ ì°¾ê³  ìµœì¢…ì ìœ¼ë¡œ í•¨ìˆ˜ê°€ ì‘ë‹µ

   ```python
   # testapp/urls.py -> ì•ˆ ë³´ì´ëŠ”ê²Œ ë‹¹ì—°í•©ë‹ˆë‹¤! ë§Œë“¤ì–´ì£¼ì„¸ìš”~
   from django.contrib import admin
   from django.urls import path, include
   from . import views # í˜„ì¬ í´ë”ì˜ views.py ë¥¼ import

   urlpatterns = [
       # http://127.0.0.1:8000/photo/ => views.py ì— home í•¨ìˆ˜ê°€ ì‘ë‹µ
       path('', views.home, name='home'),
       # http://127.0.0.1:8000/photo/new +get, post
       path('new/', views.new, name='new'),
       # http://127.0.0.1:8000/photo/pk
       path('<int:pk>/', views.detail, name='detail'),
       # http://127.0.0.1:8000/photo/pk/remove
       path('<int:pk>/remove/', views.remove, name='remove'),
       # http://127.0.0.1:8000/photo/pk/edit
       path('<int:pk>/edit/', views.edit, name='edit')
   ]
   ```

5. í•¨ìˆ˜ì˜ ë‚´ìš©ëŒ€ë¡œ í…Œì´ë¸” ë‚´ìš©ì„ ì „ì²´ ì¡°íšŒ (Photo.objects.all())
6. ì–´ë–¤ html íŒŒì¼ì´ ì‘ë‹µí•  íŒŒì¼ (photo_list.html) ì¸ì§€ ì§€ì •
7. photo_list.html ì—ì„œ ë°ì´í„°ë¥¼ ë³´ê¸° ì¢‹ê²Œ ë‚˜ì—´

### url ì„¤ê³„ (ì˜ˆì‹œ)

(ìš”ì²­) http://127.0.0.1:8000**/photo/**

â‡’ ì‘ë‹µ (í˜„ì¬ ì‚¬ì§„ ëª©ë¡ ë³´ì—¬ì£¼ê¸°)

(ìš”ì²­) http://127.0.0.1:8000/photo**/new/**

â‡’ ì‘ë‹µ (ìƒˆë¡œìš´ ì‚¬ì§„ ë“±ë¡ í¼ ë³´ì—¬ì£¼ê¸°)

(ìš”ì²­) http://127.0.0.1:8000/photo**/ìˆ«ì/**

â‡’ ì‘ë‹µ (ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ì‚¬ì§„ ìì„¸íˆ ë³´ì—¬ì£¼ê¸°)

(ìš”ì²­) http://127.0.0.1:8000**/photoapp/**

â‡’ 404 ì—ëŸ¬ê°€ ë‚œ ì´ìœ  : urls.pyì— ë“±ë¡í•˜ì§€ ì•Šì•„ì„œ

### urlì„ ë“±ë¡í•˜ëŠ” 3ê°€ì§€ ë°©ë²• (3ê°€ì§€ ë°©ë²• ëª¨ë‘ ì‚¬ìš©)

1. Function-based Views (í•¨ìˆ˜í˜• ë·°)

   - `from . import view` = í˜„ì¬ í´ë”ì˜ view.py

   ```python
   # photoapp/urls.py
   path('', views.home, name='home')
   # http://127.0.0.1:8000/photo/ => views.py ì— home í•¨ìˆ˜ê°€ ì‘ë‹µ
   ```

   ```python
   # photoapp/views.py
   def home(request):
       photos = Photo.objects.all()
       return render(request, "photo_list.html", {"photos": photos})
   ```

2. Class-based Views (í´ë˜ìŠ¤ í˜• ë·°)
3. Including another URLconf

---

## views.py

### home()

```python
def home(request):
    photos = Photo.objects.all()
    return render(request, "photo_list.html", {"photos": photos})
```

- `render(request, â€œ~~.htmlâ€, {â€™photosâ€™:photos})`
  - í…Œì´ë¸”ì— ìˆëŠ” ë‚´ìš©ì„ ë‹´ì•„ì„œ ì „ì†¡ â‡’ ì¡°íšŒí•œ ê²°ê³¼ë¥¼ photo_list.html ë¬¸ì„œì™€ ê°™ì´ ë³´ëƒ„
  - select \* from photo; (sql êµ¬ë¬¸) == Photo.objects.all() : ì „ì²´ ë‚´ìš©
  - QuerySet == `photos` : ì „ë‹¬ë°›ì€ ê°ì²´ ëª©
  - ë³€ìˆ˜ = ì „ì²´ ë‚´ìš©, render 3ë²ˆì§¸ ì¸ìˆ˜ë¡œ ë³€ìˆ˜ë¥¼ ë”•ì…”ë„ˆë¦¬í˜•ìœ¼ë¡œ ì…ë ¥

### create()

```python
def create(request):

    if request.method == "POST": # ìš°ë¦¬ê°€ ì„œë²„ì— ìš”ì²­í•œ ë°©ì‹ì´ POST ë°©ì‹ì¼ ë•Œ!
        title = request.POST['title']
        author = request.POST['author']
        image = request.POST['image']
        description = request.POST['description']
        price = request.POST['price']
				# ìš”ì²­ì— ë‹´ê¸´ íŠ¹ì • ê°ì²´ì˜ ê°’ë“¤ì„ ì €ì¥

        # í…Œì´ë¸” ë“±ë¡
        # sql : insert into photo() values(ì…ë ¥ê°’.....)
        # ORM : Photo ê°ì²´ ìƒì„± / save()
        photo = Photo(title=title, author=author, image=image,
                      description=description, price=price)
        photo.save()
        # ë“±ë¡ì™„ë£Œ í›„ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
        return redirect("/photo/")

    return render(request, "photo_new.html")
```

ğŸ› ï¸ form : ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡

method : get / post

get : ì–´ë–¤ ë°ì´í„°ê°€ ë”°ë¼ê°€ëŠ”ì§€ ì£¼ì†Œì¤„ì— ë³´ì—¬ì§ (ê¸°ë³¸ë°©ì‹ : ê²€ìƒ‰, ë‹¨ìˆœë§í¬)

post : ì–´ë–¤ ë°ì´í„°ê°€ ê°€ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ (ë¡œê·¸ì¸, íšŒì›ê°€ì…, ë³´ë‚´ì•¼ í•  ë‚´ìš©ì´ ë§ì€ ê²½ìš°)
ì „ì†¡ ì‹œ CSRF í† í°ê°’ì„ ê°™ì´ í¬í•¨ í•„ìˆ˜

action : ë°ì´í„°ê°€ ê°€ì•¼í•  ê³³ ì£¼ì†Œ (ì„œë²„) / ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ í˜ì´ì§€ê°€ í•œë²ˆë” ì“°ì„

### detail()

- pk (primary key : ì£¼ í‚¤, ê¸°ë³¸ í‚¤)
  - not null, unique ì†ì„±
  - ë‹¤ë¥¸ ë°ì´í„°ì™€ êµ¬ë³„í•˜ëŠ” ìš©ë„ (= ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸)
  - ex) select \* from photo where id=3; â†’ pkë¡œ ê±¸ë €ìœ¼ë¯€ë¡œ ë‹¨ í•œê°œì˜ ë°ì´í„°
  - ex) select \* from photo where description=3; â†’ descriptionì´ 3ì¸ ë°ì´í„° ëª¨ë‘

```python
def detail(request, pk):
    # pkì— í•´ë‹¹í•˜ëŠ” image ì •ë³´ë¥¼ ì°¾ì•„ì„œ ê°™ì´ ë³´ë‚´ì£¼ê¸°
    # sql : select * from photo where id=pk;
    # ORM :
    photo = get_object_or_404(Photo, pk=pk)  # id == pk

    return render(request, "photo_detail.html", {"photo": photo})
```

### remove()

```python
def remove(request, pk):
    # pk ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ ì°¾ì€ í›„ ì‚­ì œ
    # sql : delete from photo where id=pk;
    # ORM :
    photo = get_object_or_404(Photo, pk=pk)
    photo.delete()

    # ì´ë¯¸ì§€ ì‚­ì œ ì„±ê³µì‹œ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
    return redirect("/photo/")
```

### edit()

```python
def edit(request, pk):
    # pkì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ ì°¾ì€ í›„ ê°€ì ¸ê°€ê¸°
    photo = get_object_or_404(Photo, pk=pk)

    # ì¼ë°˜ ë°©ì‹
    if request.method == "POST":
        photo.description = request.POST['description']
        photo.price = request.POST['price']
        photo.save()
        return redirect("/photo/{}/".format(photo.pk))

    return render(request, "photo_edit.html")
```

---

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ view ë“¤ê³¼ template ê³¼ ì´ì–´ì£¼ëŠ” urls.py ë¥¼ ì‚´í´ë´¤ìŠµë‹ˆë‹¤.

ì•„ë§ˆ ì—¬ëŸ¬ë¶„ì´ ì½”ë”©ì„ í•˜ì‹œë©´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•  ë•Œ ê°€ì¥ ë§ì´ ì‚´í´ë³¼ ë‘ py ë“¤ì…ë‹ˆë‹¤.

ì•ì„  ê¸°ì´ˆ ì„¤ì •ë“¤ì€ ë¬´ì‚¬íˆ ë§ˆì¹˜ë©´ ê°€ì¥ ë§ì´ ë“¤ë½ë‚ ë½ ê±°ë¦´ ê³³ì´ë‹ˆ

ì–´ì„œ ì¹œìˆ™í•´ì§€ê¸¸ ë°”ëë‹ˆë‹¤.

ê·¸ëŸ¼ ë‹¤ìŒ ê²Œì‹œê¸€ì—ì„œ ëµ™ê² ìŠµë‹ˆë‹¤.

---

ë³¸ ê²Œì‹œê¸€ì€ ë¶€íŠ¸ìº í”„ì—ì„œ ìˆ˜ê°•í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤

---
